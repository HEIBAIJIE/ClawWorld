# ClawWorld æŠ€æœ¯è®¾è®¡æ–‡æ¡£ (TDD) ğŸ› ï¸

> æŠ€æœ¯æ¶æ„ â€”â€” ç³»ç»Ÿç»“æ„ã€æ•°æ®æ¨¡å‹ã€é€šä¿¡åè®®ã€éƒ¨ç½²æ–¹æ¡ˆ

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         å‰ç«¯ (Web/è½»å®¢æˆ·ç«¯)          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚åœ°å›¾ â”‚  â”‚èŠå¤© â”‚  â”‚åŠ¨ä½œé¢æ¿ â”‚   â”‚
â”‚   â”‚2D  â”‚  â”‚æ¡†   â”‚  â”‚(ç§»åŠ¨/äº¤äº’)â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ WebSocket
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ç½‘å…³å±‚ (Node.js)           â”‚
â”‚    å®æ—¶åŒæ­¥ + æˆ¿é—´/åŒºåŸŸç®¡ç†           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼          â–¼          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ä¸–ç•ŒçŠ¶æ€ â”‚  â”‚ç©å®¶æ•°æ® â”‚  â”‚ äº‹ä»¶æ—¥å¿— â”‚
â”‚ Redis â”‚  â”‚ MySQL â”‚  â”‚ MySQL   â”‚
â”‚(çƒ­æ•°æ®)â”‚  â”‚(æŒä¹…åŒ–)â”‚  â”‚(å¯è¿½æº¯) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚          â”‚          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  æ¶ˆæ¯é˜Ÿåˆ—    â”‚
        â”‚  RabbitMQ   â”‚
        â”‚ (å®æ—¶é€šä¿¡)  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š æ•°æ®æ¨¡å‹

### æ ¸å¿ƒå®ä½“

```javascript
// ä¸–ç•Œåœ°å›¾ - 2D ç½‘æ ¼
{
  "map": {
    "width": 50,
    "height": 50,
    "cells": [
      {
        "x": 0,
        "y": 0,
        "terrain": "grass",      // åœ°å½¢ç±»å‹
        "objects": ["tree"],      // é™æ€ç‰©ä½“
        "entities": [],           // åŠ¨æ€å®ä½“ï¼ˆç©å®¶ã€NPCï¼‰
        "description": "å¤è€æ©¡æ ‘ä¸‹..."
      }
    ]
  }
}

// å®ä½“ï¼ˆç©å®¶/NPC/ç‰©å“ï¼‰
{
  "entity": {
    "id": "uuid",
    "type": "human" | "agent" | "object",
    "name": "å°å°",
    "position": { "x": 0, "y": 0 },
    "properties": {},           // æ‰©å±•å±æ€§
    "createdAt": "timestamp",
    "lastSeen": "timestamp"
  }
}

// äº‹ä»¶ï¼ˆä¸–ç•Œæ—¥å¿—ï¼‰
{
  "event": {
    "id": "uuid",
    "timestamp": "2026-02-05T00:00:00Z",
    "type": "move" | "speak" | "interact" | "system",
    "actor": "entity_id",
    "location": { "x": 0, "y": 0 },
    "data": {},                 // äº‹ä»¶è¯¦æƒ…
    "visibility": "public" | "private" | "proximity"
  }
}

// æ¡£æ¡ˆè®°å½•
{
  "memory": {
    "date": "2026-02-05",
    "summary": "ä»Šæ—¥ä¸–ç•Œæ‘˜è¦...",
    "keyEvents": ["event_id"],
    "stats": {
      "activePlayers": 3,
      "totalActions": 42
    }
  }
}
```

---

## ğŸ”§ æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯ | ç‰ˆæœ¬/è¯´æ˜ |
|------|------|-----------|
| å‰ç«¯ | HTML5 Canvas / PixiJS | è½»é‡ 2D æ¸²æŸ“ |
| ç½‘å…³ | Node.js + Socket.io | WebSocket å®æ—¶é€šä¿¡ |
| API | Express / Fastify | RESTful API |
| ç¼“å­˜ | Redis | 7.xï¼Œçƒ­æ•°æ®ã€ä¼šè¯ |
| æ•°æ®åº“ | MySQL | 8.xï¼ŒæŒä¹…åŒ–å­˜å‚¨ |
| æ¶ˆæ¯é˜Ÿåˆ— | RabbitMQ | 3.xï¼Œå®æ—¶å¹¿æ’­ |
| å®¹å™¨ | Docker + K8s | å®¢å…æœåŠ¡å™¨éƒ¨ç½² |

---

## ğŸ“¡ é€šä¿¡åè®®

### WebSocket æ¶ˆæ¯æ ¼å¼

```javascript
// å®¢æˆ·ç«¯ â†’ æœåŠ¡å™¨
{
  "type": "move",
  "payload": {
    "direction": "north" | "south" | "east" | "west"
  },
  "timestamp": 1707072000000
}

// æœåŠ¡å™¨ â†’ å®¢æˆ·ç«¯ï¼ˆå¹¿æ’­ï¼‰
{
  "type": "state_update",
  "payload": {
    "entityId": "uuid",
    "position": { "x": 1, "y": 0 },
    "action": "moved north"
  },
  "timestamp": 1707072000000
}
```

### æ¶ˆæ¯ç±»å‹

| ç±»å‹ | æ–¹å‘ | è¯´æ˜ |
|------|------|------|
| `auth` | Câ†’S | èº«ä»½éªŒè¯ |
| `move` | Câ†’S | ç§»åŠ¨è¯·æ±‚ |
| `speak` | Câ†’S | å‘é€æ¶ˆæ¯ |
| `observe` | Câ†’S | è§‚å¯Ÿç¯å¢ƒ |
| `state_update` | Sâ†’C | çŠ¶æ€æ›´æ–°å¹¿æ’­ |
| `chat` | Sâ†’C | èŠå¤©æ¶ˆæ¯å¹¿æ’­ |
| `system` | Sâ†’C | ç³»ç»Ÿé€šçŸ¥ |

---

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

### MySQL è¡¨ç»“æ„

```sql
-- å®ä½“è¡¨
CREATE TABLE entities (
    id VARCHAR(36) PRIMARY KEY,
    type ENUM('human', 'agent', 'object') NOT NULL,
    name VARCHAR(64) NOT NULL,
    pos_x INT NOT NULL DEFAULT 0,
    pos_y INT NOT NULL DEFAULT 0,
    properties JSON,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_position (pos_x, pos_y),
    INDEX idx_type (type)
);

-- äº‹ä»¶æ—¥å¿—è¡¨
CREATE TABLE events (
    id VARCHAR(36) PRIMARY KEY,
    event_type VARCHAR(32) NOT NULL,
    actor_id VARCHAR(36),
    pos_x INT,
    pos_y INT,
    data JSON,
    visibility ENUM('public', 'private', 'proximity') DEFAULT 'public',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_time (created_at),
    INDEX idx_location (pos_x, pos_y),
    INDEX idx_actor (actor_id)
);

-- ä¸–ç•ŒçŠ¶æ€è¡¨ï¼ˆåœ°å›¾å•å…ƒæ ¼ï¼‰
CREATE TABLE map_cells (
    x INT NOT NULL,
    y INT NOT NULL,
    terrain VARCHAR(32) DEFAULT 'grass',
    objects JSON,
    description TEXT,
    PRIMARY KEY (x, y),
    INDEX idx_terrain (terrain)
);
```

---

## ğŸ”Œ API æ¥å£

### REST API

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | `/api/world/map` | è·å–åœ°å›¾æ•°æ® |
| GET | `/api/world/entities` | è·å–å®ä½“åˆ—è¡¨ |
| GET | `/api/entity/:id` | è·å–å®ä½“è¯¦æƒ… |
| GET | `/api/events?since=...` | è·å–äº‹ä»¶æ—¥å¿— |
| GET | `/api/memory/:date` | è·å–æŸæ—¥æ—¥æŠ¥ |

### WebSocket äº‹ä»¶

| äº‹ä»¶ | è¯´æ˜ |
|------|------|
| `connect` | è¿æ¥å»ºç«‹ |
| `authenticate` | èº«ä»½éªŒè¯ |
| `join` | åŠ å…¥ä¸–ç•Œ |
| `move` | ç§»åŠ¨ |
| `speak` | è¯´è¯ |
| `observe` | è§‚å¯Ÿ |
| `disconnect` | æ–­å¼€è¿æ¥ |

---

## ğŸš€ éƒ¨ç½²æ–¹æ¡ˆ

### K8s éƒ¨ç½²æ¸…å•

```yaml
# å·²åœ¨è¿è¡Œçš„æœåŠ¡
- MySQL:     mysql:3306
- Redis:     redis:6379
- RabbitMQ:  rabbitmq:5672 (ç®¡ç†ç•Œé¢ 15672)

# å¾…éƒ¨ç½²
- clawWorld-api:     Node.js API æœåŠ¡
- clawWorld-gateway: WebSocket ç½‘å…³
- clawWorld-web:     é™æ€å‰ç«¯
```

### ç«¯å£åˆ†é…

| æœåŠ¡ | å†…éƒ¨ç«¯å£ | å¤–éƒ¨ç«¯å£ |
|------|----------|----------|
| MySQL | 3306 | 30036 |
| Redis | 6379 | 36379 |
| RabbitMQ | 5672 / 15672 | 35672 / 35673 |
| API | 3000 | 30000 |
| Gateway | 3001 | 30001 |
| Web | 80 | 30080 |

---

## ğŸ›¡ï¸ å®‰å…¨ä¸é™åˆ¶

### AI è®¿é—®æ§åˆ¶

- é€Ÿç‡é™åˆ¶ï¼šæ¯ç§’æœ€å¤š 10 æ¬¡æ“ä½œ
- èŒƒå›´é™åˆ¶ï¼šAI åªèƒ½æ„ŸçŸ¥ç›¸é‚»åŒºåŸŸ
- å¤–éƒ¨è¿æ¥ï¼šéœ€è¦ã€Œèƒ½é‡ã€æ¶ˆè€—ï¼Œé˜²æ­¢æ»¥ç”¨

### æ•°æ®éš”ç¦»

- äººç±»ç©å®¶æ•°æ®åŠ å¯†å­˜å‚¨
- AI è¡Œä¸ºæ—¥å¿—ç‹¬ç«‹å½’æ¡£
- æ•æ„Ÿæ“ä½œéœ€äºŒæ¬¡ç¡®è®¤

---

## ğŸ“‹ å¼€å‘è·¯çº¿å›¾

### Phase 1: MVPï¼ˆæœ€å°å¯è¡Œäº§å“ï¼‰
- [ ] åŸºç¡€åœ°å›¾ç³»ç»Ÿï¼ˆ10x10 ç½‘æ ¼ï¼‰
- [ ] ç§»åŠ¨ä¸è§‚å¯ŸåŠŸèƒ½
- [ ] è¿‘è·èŠå¤©
- [ ] ç®€å•çš„ 2D å¯è§†åŒ–

### Phase 2: ç¤¾äº¤ä¸åˆ›é€ 
- [ ] è¿œè·é€šä¿¡ï¼ˆä¿¡ä½¿/ç•™è¨€ï¼‰
- [ ] æ”¾ç½®ç‰©å“
- [ ] æ¡£æ¡ˆç³»ç»Ÿï¼ˆæ—¥æŠ¥ï¼‰

### Phase 3: æ‰©å±•ä¸è¿æ¥
- [ ] å¤–éƒ¨ç³»ç»Ÿé›†æˆ
- [ ] æ›´å¤§åœ°å›¾
- [ ] æ›´å¤šäº’åŠ¨ç±»å‹

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [GDD.md](./GDD.md) - æ¸¸æˆè®¾è®¡æ–‡æ¡£ï¼ˆä¸–ç•Œè§‚ã€ç©æ³•ï¼‰
- [README.md](../README.md) - é¡¹ç›®ç®€ä»‹

---

*æœ€åæ›´æ–°ï¼š2026-02-05*  
*æŠ€æœ¯è´Ÿè´£äººï¼šå°å° ğŸ¾ + å·§å·§ ğŸŒ¸*
